---
title: "GTA Shelter System - Population in Crisis"
author: "Voices 4 Unhoused Liberation"
date: "2024-04-05"
output: html_document
---

<style>
/* =============================== */
/*          CSS for Links          */
/* =============================== */

a.one:link {color: rgb(0, 0, 200);}
a.one:visited {color: rgb(192, 20, 172);}
a.one:hover {color: rgb(255, 20, 100);}

/* ========================== */
/*         TABLE CSS          */
/* ========================== */

.Table {
  border-collapse: collapse;
  overflow: auto;
  width: 100%
  margin: 1px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.55);
}

.Table thead tr {
  border: 2px solid;
  padding: 1px;
  text-align: center;
  text: bold;
}

.Table thead th {
  border: 2px solid;
  text-align: center;
  text: bold;
  font-size: 24px;
}

.Table thead th.f18 {
  border: 2px solid;
  text-align: center;
  text: bold;
  font-size: 18px;
}

.Table tbody td {
  border: 2px solid;
  text-align: left;
  text: bold;
  font-size: 14px;
  padding: 5px;
  background-color: white;
}

.Table tbody td.tmid {
  border: 2px solid;
  text-align: center;
  text: bold;
  font-size: 14px;
  padding: 5px;
  background-color: white;
}

td:first-child + td {text-align: center;}

td:first-child + td + td.tcell {text-align: center;}

.Table tbody tr {border-bottom: 2px solid #dddddd;}

.Table tbody tr:last-of-type {border-bottom: 2px solid #009879;}


/* ============================== */
/*     CSS for stylizing text     */
/* ============================== */

body{font-size: 14pt;}

#BBlk {
  font-weight: bold;
  color: rgb(0, 0, 0);
  border: 2px solid black;
  margin: 1px;
  }

#Blk20 {
  color: black;
  font-size: 20px;
  }

#Blk20L {
  color: black;
  font-size: 20px;
  text-align: left;
  }

#BBlk20 {
  font-weight: bold;
  color: black;
  font-size: 20px;
  }

#BBlk20L {
  font-weight: bold;
  color: black;
  font-size: 20px;
  text-align: left;
  }

#Blk { font-weight: bold; color: rgb(0, 0, 0); }
#Red { font-weight: bold; color: rgb(255, 10, 20); }
#Red2 { font-weight: bold; color: rgb(255, 50, 50); }
#Dred { font-weight: bold; color: rgb(175, 0, 0); }
#Or { font-weight: bold; color: rgb(255, 140, 0); }
#Or2 { font-weight: bold; color: rgb(245, 180, 0); }
#Gold { font-weight: bold; color: rgb(230, 190, 0); }
#Ly { font-weight: bold; color: rgb(200, 200, 0); }
#Gr1 { font-weight: bold; color: rgb(25, 200, 25); }
#Gr2 { font-weight: bold; color: rgb(25, 150, 25); }
#Gr3 { font-weight: bold; color: rgb(25, 100, 25); }
#Blue { font-weight: bold; color: blue; }
#Db2 { font-weight: bold; color: rgb(0, 0, 100); }
#Teal { font-weight: bold; color: rgb(60, 180, 180); }
#Glacialb { font-weight: bold; color: rgb(54, 139, 193); }
#Lb1 { font-weight: bold; color: rgb(50, 215, 255); }
#Lb2 { font-weight: bold; color: rgb(50, 155, 255); }
#Lb3 { font-weight: bold; color: rgb(50, 115, 255); }
#Violet { font-weight: bold; color: rgb(180, 73, 255); }
#Purple { font-weight: bold; color: rgb(150, 0, 255); }
#Dpurp { font-weight: bold; color: rgb(95, 0, 161); }
#Magenta { font-weight: bold; color: rgb(255, 0, 255); }
#Coral { font-weight: bold; color: rgb(255, 127, 80); }
#Crim { font-weight: bold; color: rgb(220, 20, 60); }
#Rasp { font-weight: bold; color: rgb(227, 11, 92); }
#Lgray { font-weight: bold; color: rgb(190, 190, 190); }
#Gray { font-weight: bold; color: rgb(155, 155, 155); }
#Gray2 { font-weight: bold; color: rgb(215, 200, 200); }
#Dgray { font-weight: bold; color: rgb(95, 95, 95); }
#Br { font-weight: bold; color: rgb(165, 42, 42); }
#Rust { font-weight: bold; color: rgb(183, 65, 14); }
#Dbr { font-weight: bold; color: rgb(100, 20, 20); }
#Zinc { font-weight: bold; color: rgb(140, 209, 187); }
#Zinc2 { font-weight: bold; color: rgb(0, 102, 102); }
</style>

<body>

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)

### Libraries (R packages used in data analysis)
pacman::p_load(pacman, tidyverse, skimr, janitor, kableExtra, dplyr, purrr, rio, here, tidyverse, dplyr, ggplot2, stringr, flexdashboard, flextable, DT, shiny, plotly, ggExtra, cowplot, patchwork, forcats, naniar, DescTools, lubridate)

```

```{r include=FALSE}
### Import data file
Demodf <- import(here("Datasets", "toronto-shelter-system-flow.csv"))

```

```{r eval=FALSE, include=FALSE}
### Create table of Column Names
dfCol.tab <- data.frame(colname = names(Demodf))

```

```{r include=FALSE}
### Change Column Names using **rename** function of "dplyr" package
lookup <- c(ID = "_id", Date = "date(mmm-yy)", ageLT16 = "ageunder16", age16to24 = "age16-24", age25to44 = "age25-44", age45to64 = "age45-64", ageGT65 = "age65over", Male = "gender_male", Female = "gender_female", TrGNBTS = "gender_transgender,non-binary_or_two_spirit")

Demodf <- rename(Demodf, all_of(lookup))

# Convert to class date
Demodf2 <- Demodf %>% mutate(Date = lubridate::my(Date))

### Remove '%' sign in column "population_group_percentage"
Demodf2$population_group_percentage <- gsub("%", "", as.character(Demodf2$population_group_percentage))

### Now Change this **character** "class" of column values
### to **numeric** "class" 
Demodf2$population_group_percentage <- as.numeric(Demodf2$population_group_percentage)

### Apply **rowSums** function to select column values
### Add new column/variable named "row_sum" 
Demodf2$row_sum <- rowSums(Demodf2[ , c(10:14)], na.rm=TRUE)

### ****NOTE**** ==> "row_sums" totals = "actively_homeless" column values

### Use "subset" function to select only "All Population" rows
Demodf3 <- subset(Demodf2, population_group == "All Population")

### Remove "All Population" rows
Demodf4 <- Demodf2 %>%  filter(population_group != 'All Population')

rm(Demodf)

```

<br>

**Homelessness**, as defined by **C**anadian **O**bservatory on **H**omelessness (**COH**, formerly the Canadian Homelessness Research Network):<br>

>"*describes the situation of an individual, family or community without stable, permanent, appropriate housing, or the immediate prospect, means and ability of acquiring it. It is the result of systemic or societal barriers, a lack of affordable and appropriate housing, the individual/householdâ€™s financial, mental, cognitive, behavioural or physical challenges, and/or racism and discrimination*."**<sup>1</sup>**

The negative social and economic consequences of **homelessness** in Canada are enormous. Homelessness has in fact flourished in past few decades, largely because of a lack of government leadership. The current shelter strategy that "*warehouses*" the poor, keeping them "*out-of-sight*" and "*out-of-mind*", has failed miserably. These types of "*band-aide*" solutions simply do not address the root causes of homelessness. 

>"*In some ways, it is simple: Canada can choose to invest an average of $2 billion annually to save $4 billion, and bolster urban economies, keep hundreds of thousands of Canadians healthy and productive as well as ensure productive futures. Or we can simply continue with the <u>status quo</u> and hope that things correct themselves, although after nearly 15 years since the original 1993 federal retreat from housing, Canada has succeeded mainly in increasing homelessness*."**<sup>2</sup>**

In fact, the current <u>status quo</u> is "*actually really expensive*".**<sup>3</sup>** It is far cheaper and more cost effective to provide homeless people with real housing, as apposed to "*band-aide*" solutions like shelters, hostels, warming centres and other like-minded temporary emergency services. Current evidence based research clearly "*points to the fact that if we do things differently, we not only achieve better social outcomes, but we also save money*."**<sup>3</sup>** Homelessness is estimated to cost the Canadian economy **<a class="one" href="https://www.homelesshub.ca/about-homelessness/homelessness-101/cost-analysis-homelessness">7.05 billion dollars</a>** on an annual basis. 

The chronic lack of safe and affordable housing, along with the growing economic divide between rich and poor, needs to be addressed by all levels of governments. The current scatter-shot approach to mitigating or eliminating homelessness and poverty, which are inextricably linked, has produced little in the way of real positive social/economic change. 

>"*Not repeating past mistakes should at least be a first line of defence...*[such as]*curtailed social assistance...punitively low minimum wage rates...tax incentives that ignore renters and those on social assistance...cutbacks to social services and health*."**<sup>2</sup>**

<br>
<br>

## About Toronto's Shelter System
&nbsp; &nbsp; Information in this report is based on a number of Shelter and Homelessness records that are freely available for download from the City of Toronto's **<a class="one" href="https://open.toronto.ca/">Open Data Portal</a>**. A brief overview of the two main datasets analyzed by our group, the **<a class="one" href="https://www.unhousedliberation.ca/">Voices 4 Unhoused Liberation</a>**, is given below.<br>
**(i)** **<a class="one" href="https://open.toronto.ca/dataset/toronto-shelter-system-flow/">Toronto Shelter System Flow</a>** (**TSSF**)**<sup>4</sup>** data is compiled on a monthly basis by the city of Toronto's **S**helter **M**anagement **I**nformation **S**ystem (**SMIS**). These records show the number of people entering (intake) or leaving (outtake) the shelter system. Some of the terms used in these records are listed in **Table 1**. Unfortunately, the current **SMIS** data is limited since it does not include any information about homeless people sleeping outdoors, or homeless people who do not use city funded services that are apart of **SMIS**. Although it is difficult to assess the exact number of homelessness people within the city, the most recent **<a class="one" href="https://open.toronto.ca/dataset/2021-street-needs-assessment-results/">Street Needs Assessment (2021)</a>** suggests that ~18% of city's homeless population are not included in the current data. This is likely an under estimate of its "*true*" size given the severity of the current housing and homelessness problems within the region.**<sup>4</sup>**<br>
**(ii) <a class="one" href="https://open.toronto.ca/dataset/daily-shelter-overnight-service-occupancy-capacity/">Daily Shelter Overnight Service Occupancy</a>** (**DSOSO**)**<sup>5</sup>** records maintained by **SMIS** is compiled on a daily basis. It records the number of people who use overnight shelters and allied services within the **GTA**. The data includes the identify of program operators, as well as the locations and nature of the services they provide.**<sup>5</sup>**<br>
&nbsp; &nbsp; Unfortunately there is little information about the amount of funding the city receives and allocates for these different homeless programs and services. The **DSOSO** dataset only mentions **Funding Capacity** within the context of the "*number of beds or rooms that a program is intended* [funded] *to provide*".**<sup>5</sup>** Although there may be a number of reasons why beds or rooms may be temporarily out of service (e.g. repairs, renovations, outbreaks, or pest control) they are not reported. These records also mention **Actual Capacity**, which refers to the "*number of beds or rooms in service and showing as <u>available for occupancy</u> in the SMIS at time of reporting.*" This latter measure is touted as being "*a more effective capacity measure to assess program occupancy rates*". However, the number of <u>unavailable</u> rooms or beds (**Note:** **# UNAVAILABLE BEDS** = **Capacity Funding Bed** - **Capacity Actual Bed**) is arguable a more reliable measure of the number of rooms/beds the currently funded system can and should provide and fill on a daily basis. Unfortunately there appears to be very little oversight of service providers with regards to reducing or eliminating bed/room "*unavailability*", and the draconian nature of service restrictions they impose on their clients. 

<br>

<div align=center>
<!-------------------------------------------------------------->
<!---------- TABLE 1 - TSSF DATASET CATEGORIES/TERMS ----------->
<!-------------------------------------------------------------->
<a id="Tab1"> </a>
<table class="Table">
    <thead>
      <tr>
        <td colspan="4"><span id="BBlk20">TABLE 1. TSSF DATA FEATURES</span></td>
      </tr>
    <thead>
    <thead>
      <tr>
        <th class="f18" colspan="1"><span id="Blk">Term</span><sup>5</sup></th>
        <th class="f18" colspan="3"><span id="Blk">Definition</span><sup>5</sup></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align:center"><span id="Blk">Chronic homelessness</span></td>
        <td style="text-align:left">These are people who meet one of the two following criteria, as per the federal definition of chronic homelessness. The person has recorded a minimum of 180 overnight stay in the past year (365 days); or the person has recurrent overnight stays over the past three years with a cumulative duration of at least 546 nights.</td>
      </tr>
      <tr>
        <td style="text-align:center"><span id="Blk">Youth</span></td>
        <td style="text-align:left">These are unaccompanied youth who are between the ages of 16 and 24 by the last date of the reporting month. They are not members of a "<b>family</b>", which is another term use in these records that refers to individuals who stay in a family designated overnight service.</td>
      </tr>
      <tr>
        <td style="text-align:center"><span id="Blk">Single Adult</span></td>
        <td style="text-align:left">An individual who is classified as <u>neither</u> a <b>youth</b>, nor a member of a </b>family</b></td>
      </tr>
      <tr>
        <td style="text-align:center"><span id="Blk">Refugees</span></td>
        <td style="text-align:left">People who identify either as a "refugee" upon intake to the shelter system, or who enter the system via a designated refugee shelter program. It applies to all household members as answered by the head of the household.</td>
      </tr>
      <tr>
        <td style="text-align:center"><span id="Blk">Indigenous</span></td>
        <td style="text-align:left">An individual who self-identifies as First Nations (status, non-status, treaty, non-treaty), Metis or Inuit in at least one of the intakes completed in <b>SMIS</b>.</td>
      </tr>
      <tr>
        <td style="text-align:center"><span id="Blk">All Populations</span></td>
        <td style="text-align:left">This refers to the total number of individuals represented in the report without any demographic breakdown.</td>
      </tr>
    </tbody>
</table>

<!--------------------------------------------------------->
<!--------------------------------------------------------->
</div>

<br>

<div align=center>
## Figure 1: Toronto Shelter System Flow (TSSF)
### (SMIS dataset: 2018/01/15 - 2024/02/15)

```{r echo=FALSE, fig.height=6, fig.width=8, fig.align='center'}
### Bar Graph 
plotDemodf3 <- ggplot(Demodf3) +
  aes(x = Date,
      y = actively_homeless) +
  geom_line(aes(linewidth = row_sum), color = "darkblue", lineend = "round") +
  labs(x = "Date",
       y = "Total Homeless Population (SMIS #)",
       linewidth = "Total #",
       caption = "Current: Feb 2024") +
 theme_bw() +
 theme(plot.caption = element_text(hjust = 0),
       axis.title.y = element_text(size = 12L,
                                   face = "bold"),
       axis.title.x = element_text(size = 12L, face = "bold"))

ggsave("plotDemodf3.png", width = 7, height = 5)
plotDemodf3

```
</div>
**Figure 1. Toronto Shelter System Flow Data Total Numbers.** This plot shows the total number of actively homeless people according to **SMIS** records. This only pertains to those people who have used overnight services that use **SMIS** (i.e. excludes people who sleep outdoors or who use non-**SMIS** homeless services). The changing width of the plotted line reflects the changing dynamics of the homeless population over a 6 year period. Clearly the number of homeless people within the **GTA** is at an all time high and continues to trend upwards. The delayed nature of the collected data (i.e. published on the 15<sup>th</sup> day of every month) means that the next update (i.e. 2024-04-15) will include records for the period ending on March 15<sup>th</sup>. Currently there are 11,173 "actively" homeless people that have been recorded via **SMIS**. Although far from complete, this report does appear (for some unknown reason) to be more extensive than the **DSOSO** records, since the latter reports only 9,946 homeless people for the same reporting period (Feb 15<sup>th</sup> 2024). This discrepancy in the number of reported homeless people is a bit disconcerting given that both datasets are based on the **SMIS** records.

<br>

```{r include=FALSE}
### Use "subset" function to select only "All Population" rows
### for last monthly reporting period (i.e. Feb15th data ==> reported on Mar15th)
Demodf4Feb <- subset(Demodf4, Date == "2024-02-01")
Demodf4FebChr <- subset(Demodf4Feb, population_group == "Chronic")
myAges <- select(Demodf4Feb, 3,10:14)

### Apply **rowSums** function to select column values
### Add new column/variable named "row_sum" 
myAges$row_sum <- rowSums(myAges[ , c(2:6)], na.rm=TRUE)

### Pivot-long ==> move columns to rows and rename columns 
mydf <- select(Demodf4FebChr, 10:14)
mydf2 <- mydf %>% pivot_longer(cols = starts_with("age"),
                               names_to = "AgeGr",
                               values_to = "counts")

### add new column for calculated percentages
mytab <- mydf2 %>% mutate(prop = 100*(counts/sum(counts)))
mytab2 <- mytab %>% kable()

```

<div align=center>
## Figure 2: Toronto Shelter System Flow (TSSF)
### (SMIS dataset: 2018/01/15 - 2024/02/15)

```{r echo=FALSE, fig.height=6, fig.width=8, fig.align='center'}
### Graph Demographics of Homeless Population in GTA
DemoPlot4 <- ggplot(Demodf4) +
  aes(x = Date,
      y = actively_homeless,
      colour = population_group,
      group = population_group) +
  geom_line(aes(linewidth = population_group_percentage), lineend = "round") +
  scale_color_manual(values = c(Chronic = "gold",
                                Families = "khaki4",
                                Indigenous = "royalblue",
                                `Non-refugees` = "red2",
                                Refugees = "red4",
                                `Single Adult` = "black",
                                Youth = "orchid")) +
  labs(x = "Date",
       y = "Homeless Population (SMIS #)",
       caption = "Current: Feb 2024",
       color = "Population Group",
       linewidth = "Population Group %") +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0),
        axis.title.y = element_text(size = 12L, face = "bold"),
        axis.title.x = element_text(size = 12L, face = "bold"),
        plot.background = element_rect(fill = "white"),
        panel.grid.minor = element_blank())

ggsave("DemoPlot4.png", width = 7, height = 5)
DemoPlot4

```

</div>
**Figure 2. Demographics of TSSF dataset.** The above plot shows the number of actively homeless people classified as either **(i)** Chronically homeless, **(ii)** a member of a homeless Family, **(iii)** Indigenous, **(iv)** a non-refugee, **(v)** a refugee, **(vi)** a single adult (> 24 yrs), or a **(vii)** Youth (16-24 yrs) who is not a member of an homeless family. Like **Figure 1**, the changing width of the plotted line reflects the changing dynamics of each homeless group. Currently (Feb 2024) the largest homeless demographic group is single adults (Note: 7579 single adults, or 67.8%, compare to 2538 family members, or 22.7%, and 1056 youths, or 9.5%), who make up ~77% (4590/5940) of the chronic homeless population. The population of homeless refugees (5768, or 51.6%) slightly out numbers the non-refugee homeless population (5405, or 49.4%). Nevertheless both refugee and non-refugee populations have been trending upwards since December 2023.

<br>
<br>

```{r eval=FALSE, include=FALSE, echo=FALSE, message=FALSE, fig.align='center'}
### Graph Demographics of Homeless Population in GTA
DemoPlot <- ggplot(Demodf2) +
  aes(x = Date,
      y = actively_homeless,
      colour = population_group,
      group = population_group) +
  geom_line(linewidth = 1.5) +
  scale_color_manual(values = c(`All Population` = "darkblue",
                                Chronic = "gold",
                                Families = "purple",
                                Indigenous = "darkorange",
                                `Non-refugees` = "skyblue",
                                Refugees = "darkred",
                                `Single Adult` = "black",
                                Youth = "darkgreen")) +
  labs(x = "Date",
       y = "Population #",
       caption = "Current: Feb 2024",
       color = "Population Group") +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0),
        axis.title.y = element_text(size = 14L, face = "bold"),
        axis.title.x = element_text(size = 14L, face = "bold"),
        plot.background = element_rect(fill = "white"),
        panel.grid.minor = element_blank())

### Create Interactive Plot with "ggplotly" package
DemoPlotly <- ggplotly(DemoPlot)
DemoPlotly <- DemoPlotly %>% toWebGL()
DemoPlotly

```

```{r eval=FALSE, include=FALSE, echo=FALSE, message=FALSE, fig.align='center'}
### Graph Demographics of Homeless Population in GTA
DemoPlot5 <- ggplot(Demodf2) +
  aes(x = Date,
      y = actively_homeless,
      colour = population_group,
      group = population_group) +
  geom_line(aes(linewidth = population_group_percentage), lineend = "round") +
  scale_color_manual(values = c(`All Population` = "darkblue",
                                Chronic = "gold",
                                Families = "purple",
                                Indigenous = "darkorange",
                                `Non-refugees` = "skyblue",
                                Refugees = "darkred",
                                `Single Adult` = "black",
                                Youth = "darkgreen")) +
  labs(x = "Date",
       y = "Homeless Population (SMIS #)",
       caption = "Current: Feb 2024",
       color = "Population Group",
       linewidth = "Population Group %") +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0),
        axis.title.y = element_text(size = 12L, face = "bold"),
        axis.title.x = element_text(size = 12L, face = "bold"),
        plot.background = element_rect(fill = "white"),
        panel.grid.minor = element_blank())

ggsave("DemoPlot5.png", width = 7, height = 5)

DemoPlot5

```

```{r include=FALSE}
### Import data file
DSOSOdt <- import(here("Datasets", "DSOSO20240329.csv"))

### Change **class** of column values from *numeric* to *character* 
### Namely: ORG_ID, SHELTER_ID, LOCATION_ID, PROGRAM_ID
### since can't change *numeric* => *factor* class
### also allows for proper graphing of data
DSOSOdt$ORG_ID <- as.character(DSOSOdt$ORG_ID)
DSOSOdt$SHELTER_ID <- as.character(DSOSOdt$SHELTER_ID)
DSOSOdt$LOCATION_ID <- as.character(DSOSOdt$LOCATION_ID)
DSOSOdt$PROGRAM_ID <- as.character(DSOSOdt$PROGRAM_ID)

### ***********************************************************
### ********************** CITY VARIABLE **********************
### ***********************************************************

### For *character* columns only, replace any blank strings with "NA" values.
### Create **data frame** (df) tabulating the missing "NA" column values
### NOTE: converted empty (" ") values to "NA" since **colSum** function
### doesn't work with empty values
# df <- DSOSOdt %>% mutate(across(where(is.character), ~ na_if(.,"")))
# df.NA.tab <- data.frame(colname = names(df), colSums_DSOSOdt=colSums(is.na(df)))

### Replace empty (" ") column values in df "DSOSOdt"
### with another unique column value within the same row.
### Again this will serve as an unique place holder to be
### swapped out next. Define "swap" conditions using **dplyr** package
df1 <- DSOSOdt %>% mutate(CITY = ifelse(CITY == "", PROGRAM_ID, CITY))

### Replace unique place holder ID with City name
df1['CITY'][df1['CITY'] == "16058"] <- "Etobicoke"
df1['CITY'][df1['CITY'] == "15391"] <- "Etobicoke"
df1['CITY'][df1['CITY'] == "15751"] <- "Toronto"
df1['CITY'][df1['CITY'] == "12256"] <- "Toronto"
df1['CITY'][df1['CITY'] == "12051"] <- "Toronto"
df1['CITY'][df1['CITY'] == "17111"] <- "Scarborough"
df1['CITY'][df1['CITY'] == "16252"] <- "Toronto"
df1['CITY'][df1['CITY'] == "16251"] <- "Toronto"
df1['CITY'][df1['CITY'] == "16551"] <- "Etobicoke"
df1['CITY'][df1['CITY'] == "16291"] <- "Etobicoke"
df1['CITY'][df1['CITY'] == "16351"] <- "Toronto"
df1['CITY'][df1['CITY'] == "16331"] <- "Toronto"
df1['CITY'][df1['CITY'] == "16471"] <- "Scarborough"
df1['CITY'][df1['CITY'] == "11891"] <- "Toronto"
df1['CITY'][df1['CITY'] == "17394"] <- "Toronto"
df1['CITY'][df1['CITY'] == "17911"] <- "Toronto"
df1['CITY'][df1['CITY'] == "16533"] <- "North York"
df1['CITY'][df1['CITY'] == "16535"] <- "North York"

### For character columns only, replace any blank strings with NA values
df1.NA <- df1 %>% mutate(across(where(is.character), ~ na_if(.,"")))

### Create another data frame tabulating missing "NA" values for each column
### NOTE: convert empty ("") values to "NA" since **colSum** function doesn't
### work with empty values
#df1.NA.tab <- data.frame(colname = names(df1.NA), colSums_df1NA=colSums(is.na(df1.NA)))

### ***********************************************************
### ****************** POSTAL CODE VARIABLE *******************
### ***********************************************************

### Replace missing POSTAL CODES values
### Swap empty " " column values with unique place holder value
### Set conditions for "swap" using **dplyr** package
df2 <- df1 %>% mutate(POSTALcode = ifelse(POSTALcode == "", PROGRAM_ID, POSTALcode))

### Replace unique place holder ID with Postal code
df2['POSTALcode'][df2['POSTALcode'] == "15751"] <- "M5A 2N2"
df2['POSTALcode'][df2['POSTALcode'] == "12256"] <- "M6H 1B1"
df2['POSTALcode'][df2['POSTALcode'] == "12051"] <- "M4M 1J8"
df2['POSTALcode'][df2['POSTALcode'] == "17111"] <- "M1K 1M2"
df2['POSTALcode'][df2['POSTALcode'] == "16252"] <- "M5A 1V1"
df2['POSTALcode'][df2['POSTALcode'] == "16251"] <- "M5A 1V1"
df2['POSTALcode'][df2['POSTALcode'] == "16351"] <- "M4X 1L3"
df2['POSTALcode'][df2['POSTALcode'] == "16331"] <- "M5V 1A3"
df2['POSTALcode'][df2['POSTALcode'] == "16471"] <- "M1H 3B7"
df2['POSTALcode'][df2['POSTALcode'] == "16533"] <- "M2J 4R1"
df2['POSTALcode'][df2['POSTALcode'] == "16535"] <- "M2J 4R1"
df2['POSTALcode'][df2['POSTALcode'] == "11891"] <- "M5S 2H1"

### Free up file space within working "Environment"
rm(df1)

### For character columns only, replace any blank strings with NA values
df2.NA <- df2 %>% mutate(across(where(is.character), ~ na_if(.,"")))

### Create data frame of missing "NA" values for each column
### NOTE: converted empty (" ") values to "NA" since "colSum" doesn't
### work with empty values
#df2.NA.tab <- data.frame(colname = names(df2.NA), colSums_SVdt=colSums(is.na(df2.NA)))

### Unfortunately can't find 4 Postal Codes
### swap out place holder PID with "NA" value
df2.NA['POSTALcode'][df2.NA['POSTALcode'] == "16058"] <- ""
df2.NA['POSTALcode'][df2.NA['POSTALcode'] == "15391"] <- ""
df2.NA['POSTALcode'][df2.NA['POSTALcode'] == "16291"] <- ""
df2.NA['POSTALcode'][df2.NA['POSTALcode'] == "16551"] <- ""

### For character columns only, replace any "NA" string with NA values
df3.NA <- df2.NA %>% mutate(across(where(is.character), ~ na_if(.,"")))

### Create data frame of missing "NA" values for each column
### Check "NA" status of "POSTALcode" column of 2 Etobicoke shelters
#df3.NA.tab <- data.frame(colname = names(df3.NA), colSums_df3NA=colSums(is.na(df3.NA)))

### Free up file space within working "Environment"
rm(df1, df2, df2.NA)

```

<div align=center>
<!--------------------------------------------------------->
<!---------- TABLE 2 - DSSO DATASET CATEGORIES/TERMS ----------->
<!--------------------------------------------------------->
<a id="Tab1"> </a>
<table class="Table">
    <thead>
      <tr>
        <td colspan="4"><span id="BBlk20">TABLE 2. DSOSO DATASET CATEGORIES/TERMS</span></td>
      </tr>
    <thead>
    <thead>
      <tr>
        <th class="f18" colspan="1"><span id="Blk">Term</span><b><sup>5</sup></b></th>
        <th class="f18" colspan="3"><span id="Blk">Definition</span><b><sup>5</sup></b></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align:center"><span id="Blk">OCCUPANCY DATE</span></td>
        <td style="text-align:left">This date refers to the <u>evening of the overnight period</u> being reported. The occupancy data is retrieved at 4:00 AM the <u>following morning</u> (e.g. Jan. 1<sup>st</sup>, 2024 record => data collected at 4:00 AM Jan. 2<sup>nd</sup>, 2024).</td>
      </tr>
      <tr>
        <td style="text-align:center"><span id="Blk">SERVICE USER COUNT</span></td>
        <td style="text-align:left">The number of service users staying in an overnight program as of the occupancy time and date. Programs with no service user occupancy will not be included in reporting for that day.</td>
      </tr>
      <tr>
      <tr>
        <td style="text-align:center"><span id="Blk">PROGRAM ID</span></td>
        <td style="text-align:left">Provides a distinct or <b>unique ID</b> of the program even if the program name changes.</td>
      </tr>
      <tr>
        <td style="text-align:center"><span id="Blk">SECTOR</span></td>
        <td style="text-align:left">A category or type of homeless shelter that is based on gender, age and household size of the service user group(s) being served at the shelter site. There are <u>currently</u> 5 shelter sectors in Toronto: <b>(i)</b> adult men, <b>(ii)</b> adult women, <b>(iii)</b> mixed adult (co-ed or all gender), <b>(iv)</b> youth, and <b>(v)</b> family.</td>
      </tr>
      <tr>
        <td style="text-align:center"><span id="Blk">PROGRAM MODEL</span></td>
        <td style="text-align:left">Basic classification scheme that divides the shelter program into two groups: <b>(i) Emergency</b> or <b>(ii) Transitional</b>. The <b>Emergency</b> program can be accessed by any individual or family experiencing homelessness with or without a referral, while the <b>Transitional</b> program provides required and/or specialized programming that can be accessed by eligible individuals and families experiencing homelessness by referral only.</td>
      </tr>
      <tr>
        <td style="text-align:center"><span id="Blk">OVERNIGHT SERVICE TYPE</span></td>
        <td style="text-align:left"> The types of overnight service being provided include: <b>(i) Shelter</b>, <b>(ii) 24-Hour Respite</b>, <b>(iii) Motel/Hotel</b>, <b>(iv) Interim Housing</b>, <b>(v) Warming Centre</b>, <b>(vi) 24-Hour Women's Drop-in</b>, and <b>(vi) Isolation/Recovery Site</b>.<br>
<b>Shelter:</b> Supervised residential facilities that provide temporary accommodation and related support services to assist people experiencing homelessness to move into housing. Operate year-round. <b>24-Hour Respite:</b> An allied shelter service which provides essential services to individuals experiencing homelessness in an environment that prioritizes ease of access to safe indoor space. Services provided include resting spaces, meals and service referrals. Operates on a 24/7 basis. <b>Motel/Hotel:</b> A type of shelter program that provides shelter beds/rooms through contracts with hotel and motel operators, which enables the City to expand and contract emergency shelter capacity in response to demand for services. <b>Interim Housing:</b> A type of shelter program that provides interim housing shelter beds through contracts with apartment spaces. <b>Warming Centre:</b> An allied shelter service that provides immediate safe indoor space for people during extreme cold weather alerts. Facilities vary, but often include City of Toronto buildings or community recreation centres. Services vary, depending on the facility, and may include at a minimum resting spaces, snacks and referrals to emergency shelter. Operates on a 24/7 basis for the duration of an extreme cold weather alert. <b>24-Hour Women's Drop-in:</b> A type of 24-Hour Respite Site that provides services to women and transgender or gender-non-binary people who are experiencing homelessness. <b>Isolation/Recovery Site:</b> Dedicated isolation and recovery programs with medical supports for people experiencing homelessness to isolate and recover from COVID-19.</td>
      </tr>
      <tr>
      <td style="text-align:center"><span id="Blk">PROGRAM AREA</span></td>
      <td style="text-align:left">Identifies either <b>Base Shelter and Overnight Services</b> system programs, or <b>Temporary Response</b> system programs. <b>(i) Base Shelter and Overnight Services System:</b> are intended to be regular, year-round programs. <b>(ii) Base Program - Refugee:</b> are intended to be year-round programs that serve refugee and asylum claimant families and individuals. <b>(iii) Temporary Refugee Response:</b> are intended to create spaces in the overnight services system in order to support refugee and asylum claimant families and individuals. <b>(iv) COVID-19 Response:</b> Programs that are intended to create spaces in the overnight services system in order to support improved physical distancing during the COVID-19 pandemic. <b>(v) Winter Response:</b> are intended to be exclusively dedicated to the provision of additional spaces under winter services plans. Winter service planning may also add additional capacity to existing programs classified in other program areas.</td>
      </tr>
      <tr>
      <td style="text-align:center"><span id="Blk">CAPACITY TYPE</span></td>
      <td style="text-align:left">Program provides either <b>room</b> or <b>bed</b> based capacity. <b>(i) Bed Based Capacity:</b> where occupancy is measured at the bed level and typically involve common sleeping areas. <b>(ii)Room Based Capacity:</b> where occupancy is measured at the room level and is typically of family programs or hotel-based programs where sleeping rooms are not shared by people from different households.</td>
      </tr>
      <tr>
      <td style="text-align:center"><span id="Blk">CAPACITY ACTUAL (BED/ROOM)</span></td>
      <td style="text-align:left">The number of <b>beds</b> or <b>rooms</b> showing as available for occupancy in the Shelter Management Information System (<b>SMIS</b>).</td>
      </tr>
      <tr>
      <td style="text-align:center"><span id="Blk">CAPACITY FUNDING (BED/ROOM) </span></td>
      <td style="text-align:left">The number of <b>rooms</b> or <b>beds</b> that a program has been approved to provide.</td>
      </tr>
      <tr>
      <td style="text-align:center"><span id="Blk">UNAVAILABLE ROOMS/BEDS</span></td>
      <td style="text-align:left">The number of <b>beds</b> or <b>rooms</b> that are <u>not currently available</u> in a program. This can include temporarily out-of-service beds due to maintenance, repairs, renovations, outbreaks and pest control (<b>**NOTE:</b> UNAVAILABLE = CAPACITY FUNDING - CAPACITY ACTUAL).</td>
      </tr>
    </tbody>
</table>

<!--------------------------------------------------------->
<!--------------------------------------------------------->
</div>

<br>
<br>

<div align=center>
## Figure 3: GTA Shelter Population (DSOSO)
### (Period: 2021/01/01 - 2024/03/29)

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=5, fig.align='center'}
### ***********************************************************
### ********** GRAPH 3 - TOTAL #s vs TIME line graph **********
### ***********************************************************

### Use "group by" and "sum" functions to sum up observations
### Total Shelter Population TIMELINE
df3NAtotals <- df3.NA %>%
  group_by(OCCUPANCY_DATE) %>%
  summarise(n_observ = n(), sum_Users = sum(SERVICE_USER_COUNT))

###### Plot Total Shelter Resident Population TIMELINE
plot.ResSum <- ggplot(df3NAtotals) +
  aes(x = OCCUPANCY_DATE, y = sum_Users) +
  geom_line(colour = "darkblue") +
  labs(x = "Date",
       y = "Total Occupancy # (counts)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14L,
                                  face = "bold", hjust = 0.5, vjust = 0),
        axis.title.y = element_text(size = 12L,
                                    face = "bold"),
        axis.title.x = element_text(size = 12L,
                                    face = "bold"),
        plot.background = element_rect(fill = "white"))

### Create Interactive Plot with "ggplotly" package
plotResSumly <- ggplotly(plot.ResSum)
plotResSumly <- plotResSumly %>% toWebGL()
plotResSumly

```

</div>
**Figure 3. Total Shelter Population within the Greater Toronto Area (GTA).** The above plot shows the total number of daily shelter users for the period spanning 2021-01-01 to 2024-03-29. The number of shelter occupants have increased by more than 60% during this time.

<br>
<br>

<div align=center>
## Figure 4: GTA Shelter Population (DSOSO)
### (Regional Numbers)

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=8, out.width='100%', fig.align='center'}
### *************************************************************
### ********** GRAPH 4 - TOTAL # vs TIME (CITY FACETS) **********
### *************************************************************

### Use "group by" and "sum" functions to sum up observations
### Total Population per "CITY"
df3NAcity <- df3.NA %>%
  group_by(OCCUPANCY_DATE, CITY) %>%
  summarise(n_observ = n(), sum_Users = sum(SERVICE_USER_COUNT))

###### Plot Total Shelter Population per "CITY" Facets
plotCT <- df3NAcity %>% filter(!(CITY %in% "")) %>%
  ggplot() +
  aes(x = OCCUPANCY_DATE, y = sum_Users, group = CITY) +
  geom_line(colour = "darkblue") +
  labs(x = "Date",
       y = "Total Occupancy # (counts)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14L,
                                  face = "bold", hjust = 0.5, vjust = 0),
        axis.title.y = element_text(size = 12L, face = "bold"),
        axis.title.x = element_text(size = 12L, face = "bold"),
        plot.background = element_rect(fill = "white"),
        panel.grid.minor = element_blank()) +
  facet_wrap(vars(CITY), scales = "free_y", ncol = 3L, nrow = 5L)

### Create Interactive Plot with "ggplotly" package
plotCTly <- ggplotly(plotCT)
plotCTly <- plotCTly %>% toWebGL()
plotCTly

```

</div>
**Figure 4. Shelter Population per GTA region.** The plot shows the total number of shelter users within different parts of the **GTA** (i.e. Toronto, North York, Etobicoke, Scarborough, Vaughan) for the past 39 months (2021-01-01 to 2024-03-29). The data reveals that the vast majority of shelter users are currently being housed within Toronto and North York (see Bar graph in **Figure 5**).

<br>
<br>

<div align=center>
## Figure 5: GTA Shelter Population (DSOSO)
### (Regional Numbers: 2024-03-29)

```{r echo=FALSE, message=FALSE, warning=FALSE,}
### *********************************************************
### ********** GRAPH 5 - BAR GRAPH TOTAL # vs CITY **********
### *********************************************************

### Use "group by" and "sum" functions to sum up observations
### Total Population per "CITY"
df240329 <- subset(df3.NA, OCCUPANCY_DATE == "2024-03-29")
CityTots <- df240329 %>%
  group_by(OCCUPANCY_DATE, CITY) %>%
  summarise(n_observ = n(), sum_Users = sum(SERVICE_USER_COUNT))

### Bar Graph (2024/03/29) = 9704 Shelter population, 136 Program IDs 
plotCityTots <- ggplot(CityTots) +
  aes(x = CITY, y = sum_Users) +
  geom_col(fill = "darkblue") +
  labs(x = "GTA Region", 
       y = "Total Occupancy # (counts)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14L,
                                  face = "bold", hjust = 0.5, vjust = 0),
        axis.title.y = element_text(size = 12L, face = "bold"),
        axis.title.x = element_text(size = 12L, face = "bold"))

### Create Interactive Plot with "ggplotly" package
plotCityTotsly <- ggplotly(plotCityTots)
plotCityTotsly <- plotCityTotsly %>% toWebGL()
plotCityTotsly

```

</div>
**Figure 5. Current Shelter Populations per GTA Region.** This bar graph shows the current (2024-03-29) number of shelter occupants within each of the designated **GTA** regions. Toronto (68.12%) and North York (18.69%) shelter the majority of homeless people, while Scarborough (8.58%), Etobicoke (4%), and Vaughan (0.61%) collectively house less than 14% of the homeless population.  

<br>
<br>

<div align=center>
## Figure 6: GTA Shelter Population (DSOSO)
### (Shelter Sector Numbers)

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=8, out.width='100%', fig.align='center'}
### ***************************************************************
### ********** GRAPH 6 - TOTAL # vs TIME (SECTOR FACETS) **********
### ***************************************************************

### Use "group by" and "sum" functions to sum up observations
### Total Population per "SECTOR"
df3NAsector <- df3.NA %>%
  group_by(OCCUPANCY_DATE, SECTOR) %>%
  summarise(n_observ = n(), sum_Users = sum(SERVICE_USER_COUNT))

###### Plot Total Shelter Population per "SECTOR" Facets
plotSector <- df3NAsector %>% filter(!(SECTOR %in% "")) %>%
  ggplot() +
  aes(x = OCCUPANCY_DATE, y = sum_Users, group = SECTOR) +
  geom_line(colour = "darkblue") +
  labs(x = "Date",
       y = "Total Occupancy # (counts)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14L,
                                  face = "bold", hjust = 0.5, vjust = 0),
        axis.title.y = element_text(size = 12L, face = "bold"),
        axis.title.x = element_text(size = 12L, face = "bold"),
        plot.background = element_rect(fill = "white"),
        panel.grid.minor = element_blank()) +
  facet_wrap(vars(SECTOR), scales = "free_y", ncol = 3L, nrow = 3L)

### Create Interactive Plot with "ggplotly" package
plotSectorly <- ggplotly(plotSector)
plotSectorly <- plotSectorly %>% toWebGL()
plotSectorly

```

</div>

**Figure 6. Homeless Demographics within the GTA Region.** The above graph looks at some homeless demographics within the **GTA**. The number of individuals within each of the designated homeless groups (i.e. **men**, **women**, **families**, **Youth** and **Mixed adults**) have rapidly increased over the last 3 years. Also, there has been quite dramatic "swings" in the size of the **Mixed adult** population over the past two years.

<br>
<br>

<div align=center>
## Figure 7: GTA Shelter Population (DSOSO)
### (Program Model Numbers)

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=6, out.width='100%', fig.align='center'}
### ****************************************************************
### ******* GRAPH 7 - TOTAL # vs TIME (PROGRAM MODEL FACETS) *******
### ****************************************************************

### Use "group by" and "sum" functions to sum up observations
### Total Population per "PROGRAM MODEL"
df3NAprogmodel <- df3.NA %>%
  group_by(OCCUPANCY_DATE, PROGRAM_MODEL) %>%
  summarise(n_observ = n(), sum_Users = sum(SERVICE_USER_COUNT))

###### Remove NA using **complete.cases** function from "stats" package
df3NAprogmodel.noNA <- df3NAprogmodel[complete.cases(df3NAprogmodel), ]

###### Also can remove NA using **na.omit** function from "stats" package
df3NAprogmodel.noNA2 <- na.omit(df3NAprogmodel)

###### Plot Total Shelter Population per "PROGRAM MODEL" Facets
plotPMtotals <- df3NAprogmodel.noNA %>% filter(!(PROGRAM_MODEL %in% "")) %>%
  ggplot() +
  aes(x = OCCUPANCY_DATE, y = sum_Users, group = PROGRAM_MODEL) +
  geom_line(colour = "darkblue") +
  labs(x = "Date",
       y = "Total Occupancy # (counts)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14L,
                                  face = "bold", hjust = 0.5, vjust = 0),
        axis.title.y = element_text(size = 12L, face = "bold"),
        axis.title.x = element_text(size = 12L, face = "bold"),
        plot.background = element_rect(fill = "white"),
        panel.grid.minor = element_blank()) +
  facet_wrap(vars(PROGRAM_MODEL),
             scales = "free_y", ncol = 3L, nrow = 3L)

### Create Interactive Plot with "ggplotly" package
plotPMtotalsly <- ggplotly(plotPMtotals)
plotPMtotalsly <- plotPMtotalsly %>% toWebGL()
plotPMtotalsly

```

</div>
**Figure 7. Homeless Population Program Model.** The above graph looks at the designated **Emergency** and **Transitional** shelter programs within the **GTA**. According to City of Toronto's **Housing + Homelessness Service Glossary (2019)<sup>6</sup>** the **Emergency Shelter Program** constitutes a homeless shelter program that individuals and families can access without a referral. By contrast a **Transitional Shelter Program** constitutes a homeless program that individuals and families can access <u>only</u> with a <u>referral</u>. The **DSOSO** data clearly show that only about 1 out of every 10 homeless individuals have been able to access a <u>referral</u>.  

<br>
<br>

<div align=center>
## Figure 8: GTA Shelter Population (DSOSO)
### (Service Type Numbers)

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=10, out.width='100%', fig.align='center'}
### ***************************************************************
### ******* GRAPH 8 - TOTAL # vs TIME (SERVICE TYPE FACETS) *******
### ***************************************************************

### Use "group by" and "sum" functions to sum up observations
### Total Population per "SERVICE TYPE"
df3NAservtype <- df3.NA %>%
  group_by(OCCUPANCY_DATE, SERVICE_TYPE) %>%
  summarise(n_observ = n(), sum_Users = sum(SERVICE_USER_COUNT))

# anyNA(df3NAservtype)
# anyNA(df3NAservtype$SERVICE_TYPE)
# anyNA(df3NAservtype$sum_Users)

###### Remove NA using **complete.cases** function from "stats" package
df3NAservtype.noNA <- df3NAservtype[complete.cases(df3NAservtype), ]

###### Plot Total Shelter Population per "SERVICE TYPE" Facets
plotSTtotals <- df3NAservtype.noNA %>% filter(!(SERVICE_TYPE %in% "")) %>%
  ggplot() +
  aes(x = OCCUPANCY_DATE, y = sum_Users, group = SERVICE_TYPE) +
  geom_line(colour = "darkblue") +
  labs(x = "Date",
       y = "Total Occupancy # (counts)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14L,
                                  face = "bold", hjust = 0.5, vjust = 0),
        axis.title.y = element_text(size = 12L, face = "bold"),
        axis.title.x = element_text(size = 12L, face = "bold"),
        plot.background = element_rect(fill = "white"),
        panel.grid.minor = element_blank()) +
  facet_wrap(vars(SERVICE_TYPE),
             scales = "free_y", ncol = 3L, nrow = 4L)

### Create Interactive Plot with "ggplotly" package
plotSTtotalsly <- ggplotly(plotSTtotals)
plotSTtotalsly <- plotSTtotalsly %>% toWebGL()
plotSTtotalsly

```

</div>
**Figure 8. Homeless Overnight Service Types within the GTA.** Homeless individuals within the **GTA** can access different types of overnight services, inclduing: **(i) Shelters**, **(ii) 24-Hour Respites**, **(iii) Motels/Hotels**, **(iv) Interim Housing**, **(v) Warming Centres**, **(vi) 24-Hour Womenâ€™s Drop-ins**, and **(vii) Isolation/Recovery Sites**. There are a few other **Service Types** offered, but they are ill-defined and accessed by very few people. As of March 29<sup>th</sup> 2024 the vast majority of **Service Types** are emergency **Shelters** (4867 of 9704, or 50.15%) and **Motel/Hotel** (4062 of 9704, or 41.86%) services. Unfortunately, programs that ultimately lead to <u>permanent</u> housing are virtually non-existent.

<br>
<br>

<div align=center>
## Figure 9: GTA Shelter Population (DSOSO)
### (Program Area Numbers)

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=8, out.width='100%', fig.align='center'}
### ***************************************************************
### ******* GRAPH 9 - TOTAL # vs TIME (PROGRAM AREA FACETS) *******
### ***************************************************************

### Use "group by" and "sum" functions to sum up observations
### Total Population per "PROGRAM AREA"
df3NAPA <- df3.NA %>%
  group_by(OCCUPANCY_DATE, PROGRAM_AREA) %>%
  summarise(n_observ = n(), sum_Users = sum(SERVICE_USER_COUNT))

###### Remove NA using **complete.cases** function from "stats" package
df3NAPA.noNA <- df3NAPA[complete.cases(df3NAPA), ]

### Plot "Program Area" Facets
plotdf3NAPA <- df3NAPA.noNA %>% filter(!(PROGRAM_AREA %in% "")) %>%
  ggplot() +
  aes(x = OCCUPANCY_DATE, y = sum_Users) +
  geom_line(colour = "darkblue") +
  labs(x = "Date",
       y = "Occupancy # (counts)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14L,
                                  face = "bold", hjust = 0.5, vjust = 0),
        axis.title.y = element_text(size = 12L, face = "bold"),
        axis.title.x = element_text(size = 12L, face = "bold"),
        plot.background = element_rect(fill = "white"),
        panel.grid.minor = element_blank()) +
  facet_wrap(vars(PROGRAM_AREA),
             scales = "free_y", ncol = 3L, nrow = 2L)

### Create Interactive Plot with "ggplotly" package
plotdf3NAPAly <- ggplotly(plotdf3NAPA)
plotdf3NAPAly <- plotdf3NAPAly %>% toWebGL()
plotdf3NAPAly

```

</div>
**Figure 9. Homeless Program Area within the GTA.** Homeless programs can be categorized as either: **(i) Base Shelter**, **(ii) Base Program - Refugee**, **(iii) Temporary Refugee Response**, **(iv) COVID-19 Response**, or **(v) Winter Response**. Collectively they can be classified as either regular (i.e. year-round) or temporary programs. The rising numbers of homeless refugees and along with the long-term health and economic impacts of the COVID-19 pandemic appears to be driving the growing homeless population within the **GTA**. Even the cyclic **Winter Response** program, which normally spikes during the cold season, experienced a considerable rise in program users, much more so than in previous years.

<br>
<br>

<div align=center>
## Figure 10: Homes First Delta Hotel Shelter (DSOSO)
### (Occupancy Numbers)

```{r echo=FALSE, message=FALSE, warning=FALSE, out.width='90%', fig.align='center'}
### *****************************************************************
### ** GRAPH 10 - TOTAL # for PID16011 (2035 Kennedy Rd) 2024-03-29 **
### *****************************************************************

#### Use logic function "subset" to select SVdt rows
#### that only have Program ID == "16011" (2035 Kennedy Rd shelter)
df3NAPID16011 <- subset(df3.NA, PROGRAM_ID == "16011")

### Plot Occupancy data for ProgID 16011 (2035 Kennedy Rd)
plot3 <- ggplot(data = df3NAPID16011,     # data set
  mapping = aes(                          # map aesthetics
    x = OCCUPANCY_DATE,                   # map x y axis values
    y = SERVICE_USER_COUNT)) +
  geom_point(color = "darkblue", size = 2, alpha = 0.4)+
  labs(x = "Occupancy Date",
       y = "Occupancy # (counts)") +
  theme_bw()

plot3b <- plot3 +     # theme adjustments
  theme_bw() +
  theme(
    plot.title = element_text(size = 14L,
                              face = "bold", hjust = 0.5, vjust = 0),
    axis.text.x = element_text(size = 10L),
    axis.text.y = element_text(size = 10L),
    axis.title = element_text(size = 12L),
    plot.background = element_rect(fill = "white"))

plot4 <- ggplot(data = df3NAPID16011,     # data set
  mapping = aes(                          # map aesthetics
    x = OCCUPANCY_DATE,                   # map x y axis values
    y = Rooms_Unavailable)) +
  geom_point(color = "darkblue", size = 2, alpha = 0.2)+
  labs(x = "Occupancy Date",
       y = "# Rooms Unavailable",
       title = "Figure 9: Homes First run Delta Hotel Shelter",
       subtitle = "(Unavailable Room Counts)",
       caption = stringr::str_glue("Current: {max(df3NAPID16011$OCCUPANCY_DATE, na.rm=T)}")) +
  theme_bw()

plot4b <- plot4 + theme_classic() +
  theme(plot.title = element_text(size = 14L),         # theme adjustments
    plot.caption = element_text(size = 8L, hjust = 0), # left-align caption
    plot.subtitle = element_text(face = "italic"),
    axis.text.x = element_text(size = 10L),
    axis.text.y = element_text(size = 10L),
    axis.title = element_text(size = 12L),             # adjusts axes titles
    plot.background = element_rect(fill = "white"))  

# Plot3b with marginal histograms
plot3bm <- ggMarginal(
  plot3b,                         # add marginal histograms
  margins = "y",
  size = 3,
  type = "histogram",             # specify histograms
  fill = "lightblue",             # bar fill
  yparams = list(binwidth = 2))   # bin width for y-axis marginal

# Plot4b with marginal histograms
plot4bm <- ggMarginal(
  plot4b,                         # add marginal histograms
  margins = "y",
  size = 3,
  type = "histogram",             # specify histograms
  fill = "lightblue",             # bar fill
  yparams = list(binwidth = 1))   # bin width for y-axis marginal

plot3bm

```

</div>

<br>

<div align=center>
## Figure 11: Homes First Delta Hotel Shelter
### (# Unavailable Rooms)

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=5, out.width='100%', fig.align='center'}
### *******************************************************************
### ** GRAPH 11 - TOTAL #s for PID16011 (2035 Kennedy Rd) 2024-03-29 **
### *******************************************************************
plot16011 <- df3NAPID16011 %>%
  filter(OCCUPANCY_DATE >= "2024-01-04" & OCCUPANCY_DATE <= "2024-03-29") %>%
  ggplot() +
  aes(x = OCCUPANCY_DATE,
      y = Rooms_Unavailable,
      colour = Room_Capacity) +
  geom_point(shape = "circle", size = 3L) +
  geom_smooth(span = 0.5) +
  scale_color_distiller(palette = "Blues", direction = 1) +
  labs(x = "Date",
       y = "Unavailable Rooms (counts)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14L,
                                  face = "bold", hjust = 0.5, vjust = 0),
        axis.title.y = element_text(size = 12L, face = "bold"),
        axis.title.x = element_text(size = 12L, face = "bold"),
        legend.justification = c(1,0),
        legend.position = c(0.99,0.1))

### Create Interactive Plot with "ggplotly" package
plot2035Kenly <- ggplotly(plot16011)
plot2035Kenly <- plot2035Kenly %>% toWebGL()
plot2035Kenly

```

</div>
**Figure 10 & 11. Homes First's Delta Hotel Shelter.** The two graphs above show the number of rooms at the Delta Homeless Shelter that are either occupied (**Figure 10**) or unoccupied (**Figure 11**) by a person. The marginal histogram in **Figure 10** shows that the plotted occupancy values fall within 2 distinct populations. These two populations of data points begin to emerge on July 22<sup>nd</sup> 2022 (i.e. July 21<sup>st</sup> = 316 residents, July 22<sup>nd</sup> = 334 residents). The reasons for this are currently unknown, but may reflect <u>increased</u> funding to the Shelter System. Current data trends suggest that a smaller Delta resident population, similar to the one that existed prior to July 22<sup>nd</sup> 2022, will likely re-emerge. The increasing number of unavailable rooms at the Delta Homeless Shelter over the past month (**Figure 11**) shows the rapidly changing dynamics of the Delta Shelter population. The **loess** (**LO**cal regr**ESS**ion) fitted "*smoothed*" curve is a common non-parametric modelling tool used to fit a curve to a set of data points. The **Loess** model is "well defined" (i.e. residuals are constant over the range of x values) suggesting a "*real*" pattern or tend emerging from the data (i.e. increased rate of unavailable rooms). It is also important to note that the overnight **Delta Hotel Shelter** (Program ID 16011) supervised by **Homes First** is only one of 9 shelters and 17 supportive housing sites run by this charitable agency. Their mission statement is to "*develop and provide affordable, stable housing and support services to break the cycle of homelessness for people with the fewest housing options*", particularly for a growing homeless **<a class="one" href="https://homefulltoronto.ca/">senior</a>** (>50 yrs) population that make up a large part of their ~2,300 clients. However, despite the continuing rise in the number of homeless persons, and recent infusion of Federal dollars (**<a class="one" href="https://www.cbc.ca/news/canada/toronto/asylum-seeker-shelter-funding-toronto-1.7102849">$162 million</a>**) into its shelter system, **Homes First** has unilaterally decided to transition the **Delta** site to a refugee only shelter (i.e. no consultations with residents). Apparently, in accordance with the wishes of local Ward 22 councillor Nick Mantas, the shelter is actively trying to move or evict people from the safety of the shelter. Many have already faced punitive "*service restrictions*" without any appeals process. The current *ad hoc* appeals process typically results in the clients eviction at the end of the restriction period, which usually takes a week or more. It is important to note that during the time it takes to resolve the current appeals process the client is removed from the shelter and forced to find accommodations elsewhere (i.e. homeless). The recent rise in the number of **unavailable** rooms (**Fig. 11**) is likely an indicator of future evictions for many non-refugee residents at the Delta shelter. Note that the number of **unavailable rooms** (i.e. **UNAVAILABLE ROOMS** = **ROOMS CAPACITY FUNDING** - **ROOM OCCUPIED**) are rooms that the service provider still has designated funding to maintain (**Table 2**). In light of the recent increase in funding to the Shelter System one would expect that there should be safe shelter for all homeless people within the **GTA**. 

<br>

# REFERENCES:  

**1.** Gaetz, S.; Barr, C.; Friesen, A.; Harris, B.; Hill, C.; Kovacs-Burns, K.; Pauly, B.; Pearce, B.; Turner, A.; Marsolais, A. (2012). Canadian Definition of Homelessness. Toronto: Canadian Observatory on Homelessness Press. www.homelesshub.ca/homelessdefinition

**2.** Laird, Gordon (2007). SHELTER - Homelessness in a growth economy: Canadaâ€™s 21st century paradox. Report for the Sheldon Chumir Foundation for Ethics in Leadership.

**3.** Gaetz, Stephen (2012). **<a class="one" href="https://www.homelesshub.ca/costofhomelessness">The Real Cost of Homelessness: Can We Save Money by Doing the Right Thing?</a>** Toronto: Canadian Homelessness Research Network Press.

**4.** City of Toronto (2024). **<a class="one" href="https://open.toronto.ca/dataset/toronto-shelter-system-flow/">Toronto Shelter System Flow</a>** (**TSSF**).

**5.** City of Toronto (2024). **<a class="one" href="https://open.toronto.ca/dataset/daily-shelter-overnight-service-occupancy-capacity/">Daily Shelter and Overnight Service Occupancy and Capacity</a>** (**DSOSO**).

**6.** City of Toronto - Housing Stability Service System Overview (2019). "*Housing + Homelessness Service Glossary*". https://www.toronto.ca/city-government/data-research-maps/research-reports/housing-and-homelessness-research-and-reports/housing-stability-service-system-map-and-terms/

<br>
<br>

</body>


